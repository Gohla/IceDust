module names-roles

language Relations

setup Common [[
	module test
	model
]]

test Duplicate role fails [[
	entity Node {
	}
	relation Edge{
		Node * in <- x
		Node * in
		
		in.c <-> in.d
	}
]] 2 errors

test Resolve role  [[
	entity Node {
		name : String = concat(this.in.[[out]].name)
	}
	relation Edge{
		Node + in      <- in
		Node * [[out]] <- out
		in.a <-> out.b
	}
]] resolve #1 to #2

test Resolve inverse  [[
	entity Node {
		name : String = concat(this.[[in]].out.name)
	}
	relation Edge{
		Node + in  <- [[in]]
		Node * out <- out
		in.a <-> out.b
	}
]] resolve #1 to #2

test error on duplicate role [[
	entity Node {}
	relation Edge {
		Node 1 [[node]] <- a
		Node 1 [[node]] <- b
		
		node.c <-> node.d
	}
]] 2 errors // http://yellowgrass.org/issue/SPTWithCore/7

test error on duplicate role by desugaring [[
	entity Node {}
	relation Edge {
		[[Node]] 1
		[[Node]] 1
		
		node.c <-> node.d
	}
]] 4 errors // always also results in duplicate inverses // http://yellowgrass.org/issue/SPTWithCore/7
